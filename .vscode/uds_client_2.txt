elif service_int == 0x27:
    # Step 1: Request Seed
    response = client.security_access(subfunc_int)
    if response.positive:
        seed = response.service_data.seed
        logging.info(f"{tc_id} {step_desc} -> Seed: {seed.hex()}")

        # Step 2: Call external seed-to-key DLL or Python function
        try:
            key = self.calculate_key(seed, subfunc_int + 1)  # Subfunc+1 is usually the key request
        except Exception as e:
            raise Exception(f"Key Calculation Failed: {e}")

        # Step 3: Send Key
        response = client.security_access(subfunc_int + 1, key)
        if not response.positive:
            raise Exception(f"Key Response Failed: NRC={hex(response.code)}")

    else:
        raise Exception(f"Seed Request Failed: NRC={hex(response.code)}")
