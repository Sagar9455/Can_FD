from PIL import Image, ImageDraw, ImageFont

class OLEDDisplay:
    def __init__(self, width=128, height=64):
        # Init display, width and height
        self.width = width
        self.height = height
        self.font = ImageFont.load_default()
        self.display = Adafruit_SSD1306.SSD1306_128_64(rst=None)
        self.display.begin()
        self.display.clear()
        self.display.display()

    def display_text(self, text):
        # Create blank image for drawing.
        image = Image.new('1', (self.width, self.height))
        draw = ImageDraw.Draw(image)

        # Word wrap logic
        lines = []
        words = text.split(' ')
        line = ""
        for word in words:
            if draw.textlength(line + word, font=self.font) <= self.width:
                line += word + " "
            else:
                lines.append(line)
                line = word + " "
        lines.append(line)

        # Clear screen and draw text line by line
        self.display.clear()
        draw = ImageDraw.Draw(image)
        for i, line in enumerate(lines[:int(self.height / 10)]):  # Limit lines to screen height
            draw.text((0, i * 10), line.strip(), font=self.font, fill=255)

        self.display.image(image)
        self.display.display()
